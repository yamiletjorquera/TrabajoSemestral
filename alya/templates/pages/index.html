<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alya | Inicio</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/PaginaInicial.css' %}">
    <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap.min.css' %}">
</head> 
<body>
  <header>
    {% include 'base/header.html'%}
  </header>
  <main>
    <!--Carrusel--> 
    <div id="carouselExample" class="carousel slide">
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img src="{% static 'img/Inicio/carrusel.webp' %}" class="d-block w-100" alt="100">
        </div>
        <div class="carousel-item">
          <img src="{% static 'img/Inicio/carrusel2.jpg' %}" class="d-block w-100" alt="100">
        </div>
        <div class="carousel-item">
          <img src="{% static 'img/Inicio/carrusel3.jpg' %}" class="d-block w-100" alt="100">
        </div>
      </div>
      <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>
    <!--Carrusel--> 
    <h2 style="margin-bottom: 1%; margin-top: 3%; margin-left: 5.5%;" id="title">Agregados recientemente:</h2>
    <div class="row" id="mostnew" style="margin-right: 6%; margin-left: 6%;">
      
    </div>
    <div class="row" style="margin-right: 6%; margin-left: 6%;">
      <a class="btn btn-dark" href="../nuevo" role="button" style="margin-bottom: 2%">⟱</a>
    </div>
    <h2 style="margin-bottom: 1%; margin-top: 3%; margin-left: 5.5%;" id="title">Escritores conocidos:</h2>
    <div class="row" id="writers" style="margin-right: 6%; margin-left: 6%;">
      
    </div>
    <div class="row" style="margin-right: 6%; margin-left: 6%;">
      <a class="btn btn-dark" href="../escritores" role="button" style="margin-bottom: 2%">⟱</a>
    </div>
    <div id="modals">

    </div>
    {% include 'base/carrito_desplegable.html'%}
  </main>
  <footer>
    {% include 'base/footer.html'%}
  </footer>
  <script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script src="{% static 'js/jquery-3.7.1.min.js' %}"></script>
  <script>
    $(document).ready(function () {
        $.get("https://openlibrary.org/search.json?q=first_publish_year%3A[*+TO+1800]&fields=cover_i,title,author_name,first_publish_year,author_key,key,first_sentence", function(data) {
          $.each(data.docs, function (i, tmp) {
            if (i >= 6) {
              return false;
            }

            const coverUrl = "https://covers.openlibrary.org/b/id/" + tmp.cover_i + ".jpg"
            const imgElement = $("<img>").attr("src", coverUrl).addClass("card-img-top");
            imgElement.attr("src", coverUrl);

            var workString = tmp.key;
            var workCode = workString.replace("/works/", "");

            if (tmp.first_sentence === undefined) { 
              var firstSentence = "";
            } else if (Array.isArray(tmp.first_sentence)) {
              var firstSentence = tmp.first_sentence[0]+"...";
            } else {
              var firstSentence = tmp.first_sentence+"...";
            }

            var title;
            var i_title = 0;

            if (tmp.title.length > 25) {
              i_title = tmp.title.substring(0, 25).lastIndexOf(' ');
              title = tmp.title.substring(0, i_title) + "...";
            } else if (tmp.title.length > 35) {
              title = tmp.title.substring(0, 32) + "...";
            } else {
              title = tmp.title;
            }

            $("#mostnew").append(
                "<div class=\"col-2\" style=\"margin-bottom: 5%;\">" +
                    "<button type=\"button\" class=\"btn p-0\" data-bs-toggle=\"modal\" data-bs-target=\"#" + workCode + "\">" +
                        "<div class=\"card\" style=\"width: 100%;\">" +
                            imgElement.prop('outerHTML') +
                            "<div class=\"card-body\">" +
                                "<h4 class=\"card-title\"><b>" + title + "</b></h4>" +
                                "<p class=\"card-text\"><b>" + tmp.author_name[0] + "</b><br>"+tmp.first_publish_year+"</p>" +
                            "</div>" +
                        "</div>" +
                    "</button>" +
                "</div>"
            )

            $("#modals").append(
                "<div class=\"modal fade\" id=" + workCode + " aria-labelledby=\"bookModalLabel\" aria-hidden=\"true\">" +
                    "<div class=\"modal-dialog\">" +
                        "<div class=\"modal-content\">" +
                            "<div class=\"modal-header\">" +
                                "<h1 class=\"modal-title fs-5\" id=\"bookModalLabel\"></h1>" +
                                "<button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>" +
                            "</div>" +
                            "<div class=\"modal-body\">" +
                                "<div class=\"container-fluid\">" +
                                    "<div class=\"row\">" +
                                        "<div class=\"col-4\">" +
                                            imgElement.prop('outerHTML') +
                                        "</div>" +
                                        "<div class=\"col-8\">" +
                                            "<h1>" + tmp.title + "</h1>" +
                                            "<a href=\"../escritor#" + tmp.author_key[0] +"\" class=\"link-underline link-underline-opacity-0 link-underline-opacity-100-hover fst-italic fw-medium\" id=\"author_link\"><h4><br>" + tmp.author_name + "</h4></a>" +
                                            "<h6>" + tmp.first_publish_year + "</h6>" +
                                        "</div>" +
                                    "<div class=\"row\">" +
                                        "<div class=\"col-12\">" +
                                        "<h6 style=\"margin-top: 2%;\">" + firstSentence + "</h6>" +
                                        "</div>" +
                                    "</div>" +
                                "</div>" +
                            "</div>" +
                            "<div class=\"modal-footer\">" +
                                "<button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cerrar</button>" +
                                "<button type=\"button\" class=\"btn btn-primary\" disabled>Agregar al carrito</button>" +
                            "</div>" +
                        "</div>" +
                    "</div>" +
                "</div>"
              )
            }
          )
        }
      )

      $.get("https://openlibrary.org/search/authors.json?q=work_count%3A[500+TO+*]&fields=name,date,birth_date,death_date,top_work,key,work_count", function(data) {
            $.each(data.docs, function (i, tmp) {
              if (i >= 6) {
                return false;
              }

              const imgUrl = "https://covers.openlibrary.org/a/olid/" + tmp.key + ".jpg"
              const imgElement = $("<img>").attr("src", imgUrl).addClass("card-img-top");
              imgElement.attr("src", imgUrl);

              var date = " "
              if (tmp.date != undefined) {
                date = tmp.date;
              } else if (tmp.birth_date != undefined && tmp.death_date != undefined) {
                date = tmp.birth_date + " ~ " + tmp.death_date
              } else if (tmp.birth_date != undefined && tmp.death_date === undefined) {
                date = tmp.birth_date + " ~ ???"
              } else {
                date = "??? ~ ???";
              }

              $("#writers").append(
                  "<div class=\"col-2\" style=\"margin-bottom: 5%;\">" +
                      "<button type=\"button\" class=\"btn p-0\" data-bs-toggle=\"modal\" data-bs-target=\"#author_" + tmp.key + "\">" +
                          "<div class=\"card\" style=\"width: 100%;\">" +
                              imgElement.prop('outerHTML') +
                              "<div class=\"card-body\">" +
                                  "<h4 class=\"card-title\"><b>" + tmp.name + "</b></h4>" +
                                  "<p class=\"card-text\">Obra destacada: <br>\"<b><i>" + tmp.top_work + "</b></i>\"</p>" +
                              "</div>" +
                          "</div>" +
                      "</button>" +
                  "</div>"
              )

              $("#modals").append(
                  "<div class=\"modal fade\" id=author_" + tmp.key + " aria-labelledby=\"bookModalLabel\" aria-hidden=\"true\">" +
                      "<div class=\"modal-dialog\">" +
                          "<div class=\"modal-content\">" +
                              "<div class=\"modal-header\">" +
                                  "<h1 class=\"modal-title fs-5\" id=\"bookModalLabel\"></h1>" +
                                  "<button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>" +
                              "</div>" +
                              "<div class=\"modal-body\">" +
                                  "<div class=\"container-fluid\">" +
                                      "<div class=\"row\">" +
                                          "<div class=\"col-4\">" +
                                              imgElement.prop('outerHTML') +
                                          "</div>" +
                                          "<div class=\"col-8\">" +
                                              "<h1>" + tmp.name + "</h1>" +
                                              "<h6>" + date + "</h6>" +
                                              "<h6>" +  tmp.work_count + " Libros publicados</h6>" +
                                              "<h4><br>Obra destacada:<br>\"<b><i>" + tmp.top_work + "</b></i>\"</h4>" +
                                          "</div>" +
                                      "</div>" +
                                  "</div>" +
                              "</div>" +
                              "<div class=\"modal-footer\">" +
                                  "<button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Cerrar</button>" +
                                  "<a href=\"/Paginas/Escritor.html#" + tmp.key + "\" class=\"btn btn-primary\" role=\"button\">Ver más</a>" +
                              "</div>" +
                          "</div>" +
                      "</div>" +
                  "</div>"
                )
              }
            )
          }
        )
      }
    )
  </script>

  <!-- SCRIPT CARRITO -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const btnAbrirVentana = document.querySelector('.btn-abrir-ventana');
      const ventanaEmergente = document.querySelector('.ventana-emergente');

      btnAbrirVentana.addEventListener('click', function() {
        ventanaEmergente.style.right = '0';
      });

      document.addEventListener('click', function(event) {
        if (!ventanaEmergente.contains(event.target) && !btnAbrirVentana.contains(event.target)) {
          ventanaEmergente.style.right = '-33%';
        }
      });
    });
  </script>
</body>
</html>
